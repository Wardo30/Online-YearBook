{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard | Yearbook</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #2C3E50;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      background: #2C3E50;
      padding: 20px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #FDD835;
    }
    
    .logo {
      width: 80px;
      height: 80px;
    }
    
    .search-bar {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 25px;
      padding: 8px 20px;
      min-width: 400px;
    }
    
    .search-input {
      border: none;
      outline: none;
      flex: 1;
      font-size: 16px;
      padding: 8px;
    }
    
    .search-icon {
      width: 20px;
      height: 20px;
      margin-left: 10px;
    }
    
    .nav-links {
      display: flex;
      gap: 30px;
    }
    
    .nav-link {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: color 0.3s ease;
    }
    
    .nav-link:hover {
      color: #FDD835;
    }
    
    /* Main Content */
    .main-content {
      padding: 40px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Welcome Section */
    .welcome-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 50px;
    }
    
    .welcome-content {
      flex: 1;
    }
    
    .welcome-title {
      color: white;
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .action-buttons {
      display: flex;
      gap: 20px;
    }
    
    .btn-find-section {
      background: #FDD835;
      color: #2C3E50;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-find-section:hover {
      background: #FFEB3B;
      transform: translateY(-2px);
    }
    
    .btn-explore-all {
      background: #3498DB;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-explore-all:hover {
      background: #2980B9;
      transform: translateY(-2px);
    }
    
    .profile-photo {
      width: 200px;
      height: 250px;
      border-radius: 15px;
      object-fit: cover;
      border: 3px solid #FDD835;
    }
    
    /* Recent Searches Section */
    .recent-searches {
      margin-bottom: 50px;
    }
    
    .section-title {
      color: white;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 30px;
    }
    
    .search-cards {
      display: flex;
      gap: 20px;
    }
    
    .search-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      width: 200px;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    
    .search-card:hover {
      transform: translateY(-5px);
    }
    
    .search-card-placeholder {
      text-align: center;
      color: #7F8C8D;
      font-size: 14px;
    }
    
    /* Featured Albums Section */
    .featured-albums {
      margin-bottom: 50px;
    }
    
    .albums-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .view-all {
      color: white;
      text-decoration: none;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .view-all:hover {
      color: #FDD835;
    }
    
    .album-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .album-btn {
      background: #2C3E50;
      color: white;
      border: 2px solid #34495E;
      padding: 12px 25px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .album-btn:hover {
      background: #34495E;
      border-color: #FDD835;
      color: #FDD835;
    }
    
    /* Filter Section */
    .filter-section {
      margin-bottom: 50px;
    }
    
    .filter-row {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filter-label {
      color: white;
      font-size: 18px;
      font-weight: bold;
      margin-right: 10px;
    }
    
    .filter-select {
      background: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 14px;
      min-width: 150px;
      cursor: pointer;
    }
    
    /* Search Results */
    .search-results {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      margin-top: 30px;
    }
    
    .student-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .student-photo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #3498DB;
    }
    
    .student-info h5 {
      margin: 0;
      color: #2C3E50;
      font-size: 18px;
    }
    
    .student-info p {
      margin: 5px 0 0 0;
      color: #7F8C8D;
      font-size: 14px;
    }
    
    .no-results {
      text-align: center;
      color: white;
      font-size: 18px;
      padding: 40px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
      }
      
      .search-bar {
        min-width: 300px;
      }
      
      .nav-links {
        gap: 20px;
      }
      
      .welcome-section {
        flex-direction: column;
        text-align: center;
        gap: 30px;
      }
      
      .action-buttons {
        justify-content: center;
      }
      
      .filter-row {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <img src="{% static 'images/Logo.png' %}" alt="College Logo" class="logo">
    
    <div class="search-bar">
      <input type="text" class="search-input" id="searchInput" placeholder="Search students, sections, or departments...">
      <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
      </svg>
    </div>
    
    <nav class="nav-links">
      <a href="#" class="nav-link">HOME</a>
      <a href="#" class="nav-link">ABOUT US</a>
      <a href="#" class="nav-link">PROFILE</a>
      <a href="{% url 'logout' %}" class="nav-link">LOGOUT</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">Welcome, {{ user.first_name|default:user.username }}! Ready to relive the memories?</h1>
        <div class="action-buttons">
          <button class="btn-find-section" onclick="findMySection()">Find My Section</button>
          <button class="btn-explore-all" onclick="exploreAll()">Explore All</button>
        </div>
      </div>
      
      {% if student_profile and student_profile.profile_photo %}
        <img src="{{ student_profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
      {% else %}
        <div class="profile-photo" style="background: linear-gradient(135deg, #3498DB, #2980B9); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold;">
          {{ user.first_name.0|default:user.username.0|upper }}
        </div>
      {% endif %}
    </div>

    <!-- Recent Searches Section -->
    <div class="recent-searches">
      <h2 class="section-title">Recent Searches</h2>
      <div class="search-cards">
        {% for search in recent_searches %}
          <div class="search-card" onclick="performSearch('{{ search.search_query }}')">
            <div class="search-card-placeholder">
              <div style="font-weight: bold; margin-bottom: 10px;">{{ search.search_query }}</div>
              <div style="font-size: 12px;">{{ search.created_at|date:"M d" }}</div>
            </div>
          </div>
        {% empty %}
          <div class="search-card">
            <div class="search-card-placeholder">
              <div>No recent searches</div>
            </div>
          </div>
          <div class="search-card">
            <div class="search-card-placeholder">
              <div>Start searching to see history</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Featured Albums Section -->
    <div class="featured-albums">
      <div class="albums-header">
        <h2 class="section-title">Featured Albums</h2>
        <a href="#" class="view-all">
          View All
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
          </svg>
        </a>
      </div>
      <div class="album-buttons">
        <button class="album-btn" onclick="filterByDepartment('BSHM')">BSHM '25</button>
        <button class="album-btn" onclick="filterByDepartment('STEM')">STEM '25</button>
        <button class="album-btn" onclick="filterByDepartment('ABM')">ABM '25</button>
        <button class="album-btn" onclick="filterByDepartment('BSIT')">BSIT '25</button>
        <button class="album-btn" onclick="filterByDepartment('BSED')">BSED '25</button>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <div class="filter-row">
        <span class="filter-label">Filter:</span>
        <select class="filter-select" id="departmentFilter" onchange="applyFilters()">
          <option value="">Department</option>
          {% for dept_code, dept_name in departments %}
            <option value="{{ dept_code }}" {% if department == dept_code %}selected{% endif %}>{{ dept_name }}</option>
          {% endfor %}
        </select>
        <select class="filter-select" id="yearFilter" onchange="applyFilters()">
          <option value="">Year</option>
          {% for year_code, year_name in years %}
            <option value="{{ year_code }}" {% if year == year_code %}selected{% endif %}>{{ year_name }}</option>
          {% endfor %}
        </select>
        <select class="filter-select" id="blockFilter" onchange="applyFilters()">
          <option value="">Block</option>
          <option value="A" {% if block == 'A' %}selected{% endif %}>A</option>
          <option value="B" {% if block == 'B' %}selected{% endif %}>B</option>
          <option value="C" {% if block == 'C' %}selected{% endif %}>C</option>
        </select>
        <select class="filter-select" id="sectionFilter" onchange="applyFilters()">
          <option value="">Section</option>
          <option value="1" {% if section == '1' %}selected{% endif %}>1</option>
          <option value="2" {% if section == '2' %}selected{% endif %}>2</option>
          <option value="3" {% if section == '3' %}selected{% endif %}>3</option>
        </select>
      </div>
    </div>

    <!-- Search Results -->
    {% if search_query or department or year or block or section %}
      <div class="search-results">
        <h3 style="color: white; margin-bottom: 20px;">
          Search Results 
          {% if search_query %}- "{{ search_query }}"{% endif %}
          {% if students.paginator.count %}({{ students.paginator.count }} found){% endif %}
        </h3>
        
        {% if students %}
          {% for student in students %}
            <div class="student-card">
              {% if student.profile_photo %}
                <img src="{{ student.profile_photo.url }}" alt="{{ student.full_name }}" class="student-photo">
              {% else %}
                <div class="student-photo" style="background: linear-gradient(135deg, #3498DB, #2980B9); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                  {{ student.first_name.0 }}{{ student.last_name.0 }}
                </div>
              {% endif %}
              <div class="student-info">
                <h5>{{ student.full_name }}</h5>
                <p>{{ student.department }} - {{ student.year }} | Block {{ student.block }} | Section {{ student.section }}</p>
                <p>ID: {{ student.school_id }} | {{ student.email }}</p>
              </div>
            </div>
          {% endfor %}
          
          <!-- Pagination -->
          {% if students.has_other_pages %}
            <div style="display: flex; justify-content: center; margin-top: 30px;">
              <nav>
                <ul class="pagination">
                  {% if students.has_previous %}
                    <li class="page-item">
                      <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if department %}department={{ department }}&{% endif %}{% if year %}year={{ year }}&{% endif %}{% if block %}block={{ block }}&{% endif %}{% if section %}section={{ section }}&{% endif %}page={{ students.previous_page_number }}">Previous</a>
                    </li>
                  {% endif %}
                  
                  {% for num in students.paginator.page_range %}
                    {% if students.number == num %}
                      <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                      </li>
                    {% else %}
                      <li class="page-item">
                        <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if department %}department={{ department }}&{% endif %}{% if year %}year={{ year }}&{% endif %}{% if block %}block={{ block }}&{% endif %}{% if section %}section={{ section }}&{% endif %}page={{ num }}">{{ num }}</a>
                      </li>
                    {% endif %}
                  {% endfor %}
                  
                  {% if students.has_next %}
                    <li class="page-item">
                      <a class="page-link" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if department %}department={{ department }}&{% endif %}{% if year %}year={{ year }}&{% endif %}{% if block %}block={{ block }}&{% endif %}{% if section %}section={{ section }}&{% endif %}page={{ students.next_page_number }}">Next</a>
                    </li>
                  {% endif %}
                </ul>
              </nav>
            </div>
          {% endif %}
        {% else %}
          <div class="no-results">
            <p>No students found matching your search criteria.</p>
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch(this.value);
      }
    });

    function performSearch(query) {
      if (query.trim()) {
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('search', query);
        window.location.href = currentUrl.toString();
      }
    }

    function findMySection() {
      {% if student_profile %}
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('department', '{{ student_profile.department }}');
        currentUrl.searchParams.set('year', '{{ student_profile.year }}');
        currentUrl.searchParams.set('block', '{{ student_profile.block }}');
        currentUrl.searchParams.set('section', '{{ student_profile.section }}');
        window.location.href = currentUrl.toString();
      {% else %}
        alert('Please complete your profile to use this feature.');
      {% endif %}
    }

    function exploreAll() {
      const currentUrl = new URL(window.location);
      currentUrl.searchParams.delete('search');
      currentUrl.searchParams.delete('department');
      currentUrl.searchParams.delete('year');
      currentUrl.searchParams.delete('block');
      currentUrl.searchParams.delete('section');
      window.location.href = currentUrl.toString();
    }

    function filterByDepartment(department) {
      const currentUrl = new URL(window.location);
      currentUrl.searchParams.set('department', department);
      window.location.href = currentUrl.toString();
    }

    function applyFilters() {
      const department = document.getElementById('departmentFilter').value;
      const year = document.getElementById('yearFilter').value;
      const block = document.getElementById('blockFilter').value;
      const section = document.getElementById('sectionFilter').value;
      
      const currentUrl = new URL(window.location);
      
      if (department) currentUrl.searchParams.set('department', department);
      else currentUrl.searchParams.delete('department');
      
      if (year) currentUrl.searchParams.set('year', year);
      else currentUrl.searchParams.delete('year');
      
      if (block) currentUrl.searchParams.set('block', block);
      else currentUrl.searchParams.delete('block');
      
      if (section) currentUrl.searchParams.set('section', section);
      else currentUrl.searchParams.delete('section');
      
      window.location.href = currentUrl.toString();
    }
  </script>
</body>
</html>
