{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile | Yearbook</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      background: #1f2253;
      min-height: 100vh;
    }
    
    /* Yellow Header */
    .header {
      background: #ffd700;
      padding: 15px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    .logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .search-container {
      display: flex;
      align-items: center;
      flex: 1;
      max-width: 500px;
      margin: 0 20px;
    }
    
    .search-bar {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 25px;
      padding: 8px 15px;
      width: 100%;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border: 1px solid #e0e0e0;
    }
    
    .search-input {
      border: none;
      outline: none;
      flex: 1;
      font-size: 16px;
      padding: 8px 12px;
      font-family: 'Roboto', sans-serif;
      color: #333;
    }
    
    .search-input::placeholder {
      color: #999;
      font-family: 'Roboto', sans-serif;
    }
    
    .search-icon {
      color: #666;
      margin-right: 8px;
      font-size: 16px;
    }
    
    .search-btn {
      background: #FFD233;
      color: #1E1E6F;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      font-weight: 500;
      font-family: 'Roboto', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 8px;
    }
    
    .search-btn:hover {
      background: #E6C02E;
      cursor: pointer;
    }
    
    .nav-links {
      display: flex;
      gap: 30px;
    }
    
    .nav-link {
      color: #1f2253;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      font-family: 'Roboto', sans-serif;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .nav-link:hover {
      color: #1f2253;
    }
    
    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 3px;
      background: #1f2253;
    }
    
    /* Main Content */
    .main-content {
      padding: 60px 40px;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    /* Welcome Section */
    .welcome-section {
      text-align: center;
      margin-bottom: 50px;
    }
    
    .welcome-title {
      color: white;
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .welcome-subtitle {
      color: #e0e0e0;
      font-size: 20px;
    }
    
    /* Profile Card */
    .profile-card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      margin-bottom: 60px;
      text-align: center;
    }
    
    .profile-photo-container {
      position: relative;
      display: inline-block;
      margin-bottom: 30px;
    }
    
    .profile-photo {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      object-fit: cover;
      border: 6px solid #ffd700;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }
    
    .edit-photo-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: #1f2253;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .edit-photo-btn:hover {
      background: #2a2f6b;
      transform: scale(1.1);
    }
    
    .profile-name {
      color: #1f2253;
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 30px;
    }
    
    .profile-details {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .profile-detail {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background: #f8f9fa;
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    
    .profile-detail:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }
    
    .detail-icon {
      width: 24px;
      height: 24px;
      margin-right: 15px;
      color: #1f2253;
    }
    
    .detail-content {
      flex: 1;
      text-align: left;
    }
    
    .detail-label {
      color: #666;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .detail-value {
      color: #1f2253;
      font-size: 16px;
      font-weight: bold;
    }
    
    .edit-profile-btn {
      background: #1f2253;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .edit-profile-btn:hover {
      background: #2a2f6b;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(31, 34, 83, 0.3);
    }
    
    /* My Albums Section */
    .albums-section {
      background: #1E1E6F;
      padding: 60px 40px;
      margin: 40px -40px -60px -40px;
      text-align: center;
    }
    
    .albums-title {
      color: #FFD233;
      font-size: 36px;
      font-weight: bold;
      font-family: 'Roboto', sans-serif;
      margin-bottom: 50px;
    }
    
    .albums-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .album-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .album-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    }
    
    .album-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, #87CEEB, #98FB98);
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: bold;
      font-family: 'Roboto', sans-serif;
      position: relative;
      overflow: hidden;
    }
    
    .album-image::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="8" fill="white" opacity="0.8"/><circle cx="80" cy="30" r="12" fill="white" opacity="0.6"/><circle cx="60" cy="70" r="6" fill="white" opacity="0.7"/></svg>') no-repeat center;
      background-size: cover;
    }
    
    .album-button {
      background: #1E1E6F;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      font-family: 'Roboto', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }
    
    .album-button:hover {
      background: #2A2A8A;
      transform: translateY(-2px);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
      }
      
      .search-container {
        order: 2;
        width: 100%;
        max-width: none;
        margin: 10px 0;
      }
      
      .search-bar {
        width: 100%;
      }
      
      .nav-links {
        gap: 20px;
        order: 3;
      }
      
      .welcome-title {
        font-size: 36px;
      }
      
      .welcome-subtitle {
        font-size: 18px;
      }
      
      .profile-card {
        padding: 30px 20px;
      }
      
      .profile-photo {
        width: 150px;
        height: 150px;
      }
      
      .profile-name {
        font-size: 24px;
      }
      
      .albums-section {
        margin: 40px -20px -60px -20px;
        padding: 40px 20px;
      }
      
      .albums-title {
        font-size: 28px;
      }
      
      .albums-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <img src="{% static 'images/Logo.png' %}" alt="College Logo" class="logo">
    
    <div class="search-container">
      <div class="search-bar">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="Searchâ€¦" id="searchInput">
        <button class="search-btn" onclick="performSearch()">Search</button>
      </div>
    </div>
    
    <nav class="nav-links">
      <a href="{% url 'student_dashboard' %}" class="nav-link">HOME</a>
      <a href="{% url 'about' %}" class="nav-link">ABOUT US</a>
      <a href="#" class="nav-link active">PROFILE</a>
      <a href="{% url 'logout' %}" class="nav-link">LOGOUT</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <h1 class="welcome-title">Hello, {{ user.first_name|default:user.username }}!</h1>
      <p class="welcome-subtitle">Here's your personal corner of the Yearbook</p>
    </div>
    
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-photo-container">
        {% if student_profile and student_profile.profile_photo %}
          <img src="{{ student_profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
        {% else %}
          <div class="profile-photo" style="background: linear-gradient(135deg, #5da2f2, #4a8bc7); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold;">
            {{ user.first_name.0|default:user.username.0|upper }}
          </div>
        {% endif %}
        <button class="edit-photo-btn" onclick="editPhoto()">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
          </svg>
        </button>
      </div>
      
      <h2 class="profile-name">{{ user.first_name }} {{ user.last_name }}</h2>
      
      <div class="profile-details">
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">School Role</div>
            <div class="detail-value">Student</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">School ID</div>
            <div class="detail-value">{{ student_profile.school_id|default:"Not set" }}</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm1.5.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">Department</div>
            <div class="detail-value">{{ student_profile.get_department_display|default:"Not set" }}</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm1.5.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">Section</div>
            <div class="detail-value">{{ student_profile.section|default:"Not set" }}</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">Block</div>
            <div class="detail-value">{{ student_profile.block|default:"Not set" }}</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">Year Level</div>
            <div class="detail-value">{{ student_profile.year|default:"Not set" }}</div>
          </div>
        </div>
        
        <div class="profile-detail">
          <svg class="detail-icon" fill="currentColor" viewBox="0 0 16 16">
            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.708 2.825L15 11.105V5.383zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741zM1 11.105l4.708-2.897L1 5.383v5.722z"/>
          </svg>
          <div class="detail-content">
            <div class="detail-label">Email</div>
            <div class="detail-value">{{ user.email|default:"Not set" }}</div>
          </div>
        </div>
      </div>
      
      <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
    </div>
    
    <!-- My Albums Section -->
    <div class="albums-section">
      <h2 class="albums-title">My Albums</h2>
      
      <div class="albums-grid">
        <div class="album-card">
          <div class="album-image">
            <span>Album Preview</span>
          </div>
          <button class="album-button" onclick="viewAlbum('BSIT25')">BSIT 25</button>
        </div>
        
        <div class="album-card">
          <div class="album-image">
            <span>Album Preview</span>
          </div>
          <button class="album-button" onclick="viewAlbum('BSIT26')">BSIT 26</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_first_name" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="id_first_name" name="first_name" value="{{ user.first_name }}">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_last_name" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="id_last_name" name="last_name" value="{{ user.last_name }}">
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_middle_name" class="form-label">Middle Name</label>
                  <input type="text" class="form-control" id="id_middle_name" name="middle_name" value="{{ student_profile.middle_name|default:'' }}">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_school_id" class="form-label">School ID</label>
                  <input type="text" class="form-control" id="id_school_id" name="school_id" value="{{ student_profile.school_id|default:'' }}">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="id_email" class="form-label">Email</label>
              <input type="email" class="form-control" id="id_email" name="email" value="{{ user.email }}">
            </div>
            
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="id_department" class="form-label">Department</label>
                  <select class="form-select" id="id_department" name="department">
                    <option value="">Select Department</option>
                    {% for dept_code, dept_name in departments %}
                      <option value="{{ dept_code }}" {% if student_profile.department == dept_code %}selected{% endif %}>{{ dept_name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="id_year" class="form-label">Year</label>
                  <select class="form-select" id="id_year" name="year">
                    <option value="">Select Year</option>
                    {% for year_code, year_name in years %}
                      <option value="{{ year_code }}" {% if student_profile.year == year_code %}selected{% endif %}>{{ year_name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="id_block" class="form-label">Block</label>
                  <select class="form-select" id="id_block" name="block">
                    <option value="">Select Block</option>
                    <option value="A" {% if student_profile.block == 'A' %}selected{% endif %}>A</option>
                    <option value="B" {% if student_profile.block == 'B' %}selected{% endif %}>B</option>
                    <option value="C" {% if student_profile.block == 'C' %}selected{% endif %}>C</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_section" class="form-label">Section</label>
                  <input type="text" class="form-control" id="id_section" name="section" value="{{ student_profile.section|default:'' }}">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="id_profile_photo" class="form-label">Profile Photo</label>
                  <input type="file" class="form-control" id="id_profile_photo" name="profile_photo" accept="image/*">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="id_achievements" class="form-label">Achievements</label>
              <textarea class="form-control" id="id_achievements" name="achievements" rows="3">{{ student_profile.achievements|default:'' }}</textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function editProfile() {
      const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
      modal.show();
    }
    
    function editPhoto() {
      document.getElementById('id_profile_photo').click();
    }
    
    function viewAlbum(albumName) {
      alert('Viewing album: ' + albumName);
      // You can implement: window.location.href = '/album/' + albumName + '/';
    }
    
    function performSearch() {
      const searchInput = document.getElementById('searchInput');
      const query = searchInput.value.trim();
      
      if (query) {
        alert('You searched for: ' + query);
        // You can implement actual search functionality here
        // For example: window.location.href = '/search/?q=' + encodeURIComponent(query);
      } else {
        alert('Please enter a search term');
      }
    }
    
    // Add Enter key functionality to search input
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    // Auto-submit form when profile photo is selected
    document.getElementById('id_profile_photo').addEventListener('change', function(e) {
      if (e.target.files.length > 0) {
        // Create a form and submit it
        const form = document.createElement('form');
        form.method = 'POST';
        form.enctype = 'multipart/form-data';
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        
        const photoInput = document.createElement('input');
        photoInput.type = 'file';
        photoInput.name = 'profile_photo';
        photoInput.files = e.target.files;
        form.appendChild(photoInput);
        
        document.body.appendChild(form);
        form.submit();
      }
    });
  </script>
</body>
</html>
