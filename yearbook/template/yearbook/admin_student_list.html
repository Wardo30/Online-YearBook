{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Students | Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #2C3E50;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      background: #2C3E50;
      padding: 20px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #FDD835;
    }
    
    .logo {
      width: 80px;
      height: 80px;
    }
    
    .header-title {
      color: white;
      font-size: 28px;
      font-weight: bold;
      margin: 0;
    }
    
    .nav-links {
      display: flex;
      gap: 30px;
    }
    
    .nav-link {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: color 0.3s ease;
    }
    
    .nav-link:hover {
      color: #FDD835;
    }
    
    /* Main Content */
    .main-content {
      padding: 40px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .section-title {
      color: white;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 30px;
    }
    
    /* Search and Filters */
    .search-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .search-form {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
      gap: 15px;
      align-items: end;
    }
    
    .form-group {
      margin-bottom: 0;
    }
    
    .form-label {
      color: white;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .form-control {
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 14px;
    }
    
    .btn-search {
      background: #FDD835;
      color: #2C3E50;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-search:hover {
      background: #FFEB3B;
    }
    
    /* Action Bar */
    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .btn-add {
      background: #27AE60;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-weight: bold;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .btn-add:hover {
      background: #229954;
      color: white;
      text-decoration: none;
    }
    
    .bulk-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .btn-bulk {
      background: #E74C3C;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-bulk:hover {
      background: #C0392B;
    }
    
    /* Student Table */
    .students-table {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .table {
      margin: 0;
    }
    
    .table thead th {
      background: #2C3E50;
      color: white;
      border: none;
      padding: 15px;
      font-weight: bold;
    }
    
    .table tbody td {
      padding: 15px;
      vertical-align: middle;
      border-bottom: 1px solid #ECF0F1;
    }
    
    .table tbody tr:hover {
      background-color: #F8F9FA;
    }
    
    .student-photo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #3498DB;
    }
    
    .student-name {
      font-weight: bold;
      color: #2C3E50;
      margin: 0;
    }
    
    .student-info {
      color: #7F8C8D;
      font-size: 12px;
      margin: 0;
    }
    
    .department-badge {
      background: #3498DB;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    .btn-action {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-view {
      background: #3498DB;
      color: white;
    }
    
    .btn-edit {
      background: #F39C12;
      color: white;
    }
    
    .btn-delete {
      background: #E74C3C;
      color: white;
    }
    
    .btn-action:hover {
      opacity: 0.8;
    }
    
    /* Pagination */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 30px;
    }
    
    .pagination .page-link {
      background: #2C3E50;
      color: white;
      border: 1px solid #34495E;
    }
    
    .pagination .page-link:hover {
      background: #34495E;
      color: white;
    }
    
    .pagination .page-item.active .page-link {
      background: #FDD835;
      color: #2C3E50;
      border-color: #FDD835;
    }
    
    /* Messages */
    .alert {
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
      }
      
      .search-form {
        grid-template-columns: 1fr;
      }
      
      .action-bar {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      
      .table-responsive {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <img src="{% static 'images/Logo.png' %}" alt="College Logo" class="logo">
    
    <h1 class="header-title">Manage Students</h1>
    
    <nav class="nav-links">
      <a href="{% url 'admin_dashboard' %}" class="nav-link">DASHBOARD</a>
      <a href="{% url 'admin_student_list' %}" class="nav-link" style="color: #FDD835;">STUDENTS</a>
      <a href="{% url 'admin_album_list' %}" class="nav-link">ALBUMS</a>
      <a href="{% url 'logout' %}" class="nav-link">LOGOUT</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Search and Filters -->
    <div class="search-section">
      <form method="GET" class="search-form">
        <div class="form-group">
          <label class="form-label">Search</label>
          {{ search_form.search }}
        </div>
        <div class="form-group">
          <label class="form-label">Department</label>
          {{ search_form.department }}
        </div>
        <div class="form-group">
          <label class="form-label">Year</label>
          {{ search_form.year }}
        </div>
        <div class="form-group">
          <label class="form-label">Block</label>
          {{ search_form.block }}
        </div>
        <div class="form-group">
          <label class="form-label">Section</label>
          {{ search_form.section }}
        </div>
        <div class="form-group">
          <button type="submit" class="btn-search">Search</button>
        </div>
      </form>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
      <a href="{% url 'admin_student_add' %}" class="btn-add">+ Add New Student</a>
      
      <div class="bulk-actions">
        <form method="POST" action="{% url 'admin_bulk_operations' %}" id="bulkForm" style="display: none;">
          {% csrf_token %}
          <input type="hidden" name="action" id="bulkAction">
          <input type="hidden" name="selected_students" id="selectedStudents">
        </form>
        
        <button type="button" class="btn-bulk" onclick="bulkAction('honor_roll')">Mark Honor Roll</button>
        <button type="button" class="btn-bulk" onclick="bulkAction('export')">Export Selected</button>
        <button type="button" class="btn-bulk" onclick="bulkAction('delete')">Delete Selected</button>
      </div>
    </div>

    <!-- Students Table -->
    <div class="students-table">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>
              <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
            </th>
            <th>Photo</th>
            <th>Name</th>
            <th>School ID</th>
            <th>Department</th>
            <th>Year</th>
            <th>Block</th>
            <th>Section</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr>
              <td>
                <input type="checkbox" class="student-checkbox" value="{{ student.id }}" onchange="updateSelectedStudents()">
              </td>
              <td>
                {% if student.profile_photo %}
                  <img src="{{ student.profile_photo.url }}" alt="{{ student.full_name }}" class="student-photo">
                {% else %}
                  <div class="student-photo" style="background: linear-gradient(135deg, #3498DB, #2980B9); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">
                    {{ student.first_name.0 }}{{ student.last_name.0 }}
                  </div>
                {% endif %}
              </td>
              <td>
                <div class="student-name">{{ student.full_name }}</div>
                <div class="student-info">{{ student.user.username|default:"No Account" }}</div>
              </td>
              <td>{{ student.school_id }}</td>
              <td>
                <span class="department-badge">{{ student.department }}</span>
              </td>
              <td>{{ student.year }}</td>
              <td>{{ student.block }}</td>
              <td>{{ student.section }}</td>
              <td>{{ student.email }}</td>
              <td>
                <div class="action-buttons">
                  <a href="{% url 'admin_student_detail' student.id %}" class="btn-action btn-view">View</a>
                  <a href="{% url 'admin_student_edit' student.id %}" class="btn-action btn-edit">Edit</a>
                  <a href="{% url 'admin_student_delete' student.id %}" class="btn-action btn-delete">Delete</a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="10" style="text-align: center; padding: 40px; color: #7F8C8D;">
                <p>No students found.</p>
                <a href="{% url 'admin_student_add' %}" class="btn-add">Add First Student</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if students.has_other_pages %}
      <div class="pagination-container">
        <nav>
          <ul class="pagination">
            {% if students.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.department %}department={{ request.GET.department }}&{% endif %}{% if request.GET.year %}year={{ request.GET.year }}&{% endif %}{% if request.GET.block %}block={{ request.GET.block }}&{% endif %}{% if request.GET.section %}section={{ request.GET.section }}&{% endif %}page={{ students.previous_page_number }}">Previous</a>
              </li>
            {% endif %}
            
            {% for num in students.paginator.page_range %}
              {% if students.number == num %}
                <li class="page-item active">
                  <span class="page-link">{{ num }}</span>
                </li>
              {% else %}
                <li class="page-item">
                  <a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.department %}department={{ request.GET.department }}&{% endif %}{% if request.GET.year %}year={{ request.GET.year }}&{% endif %}{% if request.GET.block %}block={{ request.GET.block }}&{% endif %}{% if request.GET.section %}section={{ request.GET.section }}&{% endif %}page={{ num }}">{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}
            
            {% if students.has_next %}
              <li class="page-item">
                <a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.department %}department={{ request.GET.department }}&{% endif %}{% if request.GET.year %}year={{ request.GET.year }}&{% endif %}{% if request.GET.block %}block={{ request.GET.block }}&{% endif %}{% if request.GET.section %}section={{ request.GET.section }}&{% endif %}page={{ students.next_page_number }}">Next</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    {% endif %}
  </div>

  <script>
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.student-checkbox');
      
      checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
      });
      
      updateSelectedStudents();
    }
    
    function updateSelectedStudents() {
      const checkboxes = document.querySelectorAll('.student-checkbox:checked');
      const selectedIds = Array.from(checkboxes).map(cb => cb.value);
      document.getElementById('selectedStudents').value = selectedIds.join(',');
      
      // Update select all checkbox state
      const allCheckboxes = document.querySelectorAll('.student-checkbox');
      const selectAll = document.getElementById('selectAll');
      
      if (checkboxes.length === 0) {
        selectAll.checked = false;
        selectAll.indeterminate = false;
      } else if (checkboxes.length === allCheckboxes.length) {
        selectAll.checked = true;
        selectAll.indeterminate = false;
      } else {
        selectAll.checked = false;
        selectAll.indeterminate = true;
      }
    }
    
    function bulkAction(action) {
      const selectedStudents = document.getElementById('selectedStudents').value;
      
      if (!selectedStudents) {
        alert('Please select at least one student.');
        return;
      }
      
      if (action === 'delete' && !confirm('Are you sure you want to delete the selected students? This action cannot be undone.')) {
        return;
      }
      
      document.getElementById('bulkAction').value = action;
      document.getElementById('bulkForm').submit();
    }
  </script>
</body>
</html>
